
================================================================================
COMPLETE SM NUTS-2 PREPROCESSING
================================================================================
Input:  C:\Github\SM\iDesignRES_transcompmodel\examples\moving_loads_SM\data\Trucktraffic_NUTS3
Output: C:\Github\SM\iDesignRES_transcompmodel\examples\moving_loads_SM\input_data
================================================================================
================================================================================
LOADING DATA
================================================================================
[OK] Truck traffic (before filtering): 1,514,573 rows
[OK] Network (before filtering): 1675 nodes, 3580 edges

Applying NUTS-2 aggregation filtering with spatial join...
  Loading NUTS shapefile: C:\Github\SM\iDesignRES_transcompmodel\examples\moving_loads_SM\data\NUTS_RG_20M_2021_4326.shp\NUTS_RG_20M_2021_4326.shp
  Loaded 2010 NUTS regions
  Filtering for NUTS codes: ['DE', 'DK', 'SE', 'AT3', 'ITC', 'ITH', 'ITI', 'ITF', 'NO08', 'NO07', 'FI1D', 'NO09', 'NO0A', 'NO02', 'NO06', 'AT33', 'AT34', 'AT32']
  Found 81 NUTS-2 regions matching filter
  Created GeoDataFrame with 1675 NUTS-3 zones
    NUTS_0: 461 NUTS-3 zones
    NUTS_1: 105 NUTS-3 zones
    NUTS_2: 36 NUTS-3 zones
  Total NUTS-3 zones after spatial filtering: 592
  Mapping NUTS-3 zones to NUTS-2 regions...
  Mapped 592 NUTS-3 zones to 81 NUTS-2 regions
  Edges filtered: 3,580 -> 1,342 (removed 2,238)
  Edge distance map: 1,342 edges

  FREIGHT STATISTICS (Initial):
    Total traffic rows: 1,514,573
    Total freight volume: 263,564,234,398.75 tkm

  FREIGHT STATISTICS (After filtering):
    Retained traffic rows: 1,043,727 (68.9%)
    Retained freight volume: 124,298,175,377.50 tkm (47.2%)

  ROUTE TYPE BREAKDOWN (Retained freight):
    Internal routes (both inside): 256,554 rows, 60,512,357,803.75 tkm (48.7%)
    Entering routes (origin outside): 367,812 rows, 34,510,312,693.75 tkm (27.8%)
    Leaving routes (destination outside): 419,361 rows, 29,275,504,880.00 tkm (23.6%)

  REMOVED FREIGHT:
    Geographic filter: 470,846 rows, 139,266,059,021.25 tkm (52.8%)

[OK] NUTS-2 FILTERING COMPLETE:
  NUTS-3 zones: 592
  NUTS-2 regions: 81
  Network nodes (after filtering): 592
  Network edges (after filtering): 1,342
  Truck traffic (after filtering): 1,043,727 rows

================================================================================
STEP 1: CREATING NUTS-2 GEOGRAPHIC ELEMENTS
================================================================================
  Found 81 unique NUTS-2 regions
  Aggregating from 592 network nodes
[OK] Created 81 NUTS-2 geographic elements
     Reduction: 592 nodes -> 81 NUTS-2 regions

================================================================================
STEP 2: BUILDING EDGE TOPOLOGY
================================================================================
[OK] Built edge topology: 174 edges total
    • Inter-regional (cross-border): 260
    • Intra-regional (within NUTS2): 1021
[FIXED] Now preserves routing through intermediate regions like Austria

================================================================================
STEP 3: CREATING PATHS WITH COLLAPSED NODES + ORIGINAL DISTANCES
================================================================================
WARNING: TEMPORARY - Local routes (origin == destination) are filtered out
         This prevents infeasibility from multi-node travel time constraints
================================================================================
  Valid traffic rows: 912,824
  Unique OD-pairs (before validation): 912,824
  Validating OD-pairs (checking if endpoints can be mapped to NUTS-2 nodes)...
  Valid OD-pairs (after validation): 907,766
  Filtered out 5,058 OD-pairs
    (includes unmappable endpoints AND local routes where origin == destination)
  Created 14000 OD-pairs...
  Created 15000 OD-pairs...
  Created 18000 OD-pairs...
  Created 22000 OD-pairs...
  Created 23000 OD-pairs...
  Created 24000 OD-pairs...
  Created 25000 OD-pairs...
  Created 84000 OD-pairs...
  Created 88000 OD-pairs...
  Created 89000 OD-pairs...
  Created 94000 OD-pairs...
  Created 95000 OD-pairs...
  Created 99000 OD-pairs...
  Created 102000 OD-pairs...
  Created 103000 OD-pairs...
  Created 104000 OD-pairs...
  Created 105000 OD-pairs...
  Created 107000 OD-pairs...
  Created 110000 OD-pairs...
  Created 111000 OD-pairs...
  Created 114000 OD-pairs...
  Created 117000 OD-pairs...
  Created 121000 OD-pairs...
  Created 122000 OD-pairs...
  Created 124000 OD-pairs...
  Created 125000 OD-pairs...
  Created 130000 OD-pairs...
  Created 131000 OD-pairs...
  Created 135000 OD-pairs...
  Created 148000 OD-pairs...
  Created 155000 OD-pairs...
  Created 156000 OD-pairs...
  Created 157000 OD-pairs...
  Created 158000 OD-pairs...
  Created 159000 OD-pairs...
  Created 160000 OD-pairs...
  Created 162000 OD-pairs...
  Created 163000 OD-pairs...
  Created 164000 OD-pairs...
  Created 166000 OD-pairs...
  Created 167000 OD-pairs...
  Created 168000 OD-pairs...
  Created 169000 OD-pairs...
  Created 170000 OD-pairs...
  Created 173000 OD-pairs...
  Created 174000 OD-pairs...
  Created 176000 OD-pairs...
  Created 180000 OD-pairs...
  Created 181000 OD-pairs...
  Created 183000 OD-pairs...
  Created 184000 OD-pairs...
  Created 185000 OD-pairs...
  Created 188000 OD-pairs...
  Created 191000 OD-pairs...
  Created 194000 OD-pairs...
  Created 195000 OD-pairs...
  Created 196000 OD-pairs...
  Created 197000 OD-pairs...
  Created 198000 OD-pairs...
  Created 199000 OD-pairs...
  Created 200000 OD-pairs...
  Created 202000 OD-pairs...
  Created 203000 OD-pairs...
  Created 204000 OD-pairs...
  Created 205000 OD-pairs...
  Created 207000 OD-pairs...
  Created 210000 OD-pairs...
  Created 214000 OD-pairs...
  Created 215000 OD-pairs...
  Created 221000 OD-pairs...
  Created 223000 OD-pairs...
  Created 225000 OD-pairs...
  Created 230000 OD-pairs...
  Created 233000 OD-pairs...
  Created 235000 OD-pairs...
  Created 236000 OD-pairs...
  Created 239000 OD-pairs...
  Created 240000 OD-pairs...
  Created 241000 OD-pairs...
  Created 243000 OD-pairs...
  Created 251000 OD-pairs...
  Created 252000 OD-pairs...
  Created 253000 OD-pairs...
  Created 256000 OD-pairs...
  Created 257000 OD-pairs...
  Created 258000 OD-pairs...
  Created 259000 OD-pairs...
  Created 264000 OD-pairs...
  Created 267000 OD-pairs...
  Created 268000 OD-pairs...
  Created 269000 OD-pairs...
  Created 275000 OD-pairs...
  Created 276000 OD-pairs...
  Created 278000 OD-pairs...
  Created 283000 OD-pairs...
  Created 284000 OD-pairs...
  Created 285000 OD-pairs...
  Created 287000 OD-pairs...
  Created 289000 OD-pairs...
  Created 290000 OD-pairs...
  Created 296000 OD-pairs...
  Created 297000 OD-pairs...
  Created 298000 OD-pairs...
  Created 301000 OD-pairs...
  Created 302000 OD-pairs...
  Created 303000 OD-pairs...
  Created 307000 OD-pairs...
  Created 309000 OD-pairs...
  Created 310000 OD-pairs...
  Created 311000 OD-pairs...
  Created 317000 OD-pairs...
  Created 325000 OD-pairs...
  Created 326000 OD-pairs...
  Created 327000 OD-pairs...
  Created 329000 OD-pairs...
  Created 334000 OD-pairs...
  Created 335000 OD-pairs...
  Created 336000 OD-pairs...
  Created 340000 OD-pairs...
  Created 348000 OD-pairs...
  Created 349000 OD-pairs...
  Created 350000 OD-pairs...
  Created 354000 OD-pairs...
  Created 357000 OD-pairs...
  Created 361000 OD-pairs...
  Created 363000 OD-pairs...
  Created 366000 OD-pairs...
  Created 367000 OD-pairs...
  Created 368000 OD-pairs...
  Created 372000 OD-pairs...
  Created 376000 OD-pairs...
  Created 378000 OD-pairs...
  Created 382000 OD-pairs...
  Created 387000 OD-pairs...
  Created 391000 OD-pairs...
  Created 396000 OD-pairs...
  Created 397000 OD-pairs...
  Created 401000 OD-pairs...
  Created 408000 OD-pairs...
  Created 414000 OD-pairs...
  Created 425000 OD-pairs...
  Created 429000 OD-pairs...
  Created 435000 OD-pairs...
  Created 436000 OD-pairs...
  Created 437000 OD-pairs...
  Created 439000 OD-pairs...
  Created 440000 OD-pairs...
  Created 441000 OD-pairs...
  Created 445000 OD-pairs...
  Created 447000 OD-pairs...
  Created 448000 OD-pairs...
  Created 449000 OD-pairs...
  Created 451000 OD-pairs...
  Created 452000 OD-pairs...
  Created 455000 OD-pairs...
  Created 460000 OD-pairs...
  Created 464000 OD-pairs...
  Created 465000 OD-pairs...
  Created 467000 OD-pairs...
  Created 470000 OD-pairs...
  Created 472000 OD-pairs...
  Created 474000 OD-pairs...
  Created 487000 OD-pairs...
  Created 488000 OD-pairs...
  Created 489000 OD-pairs...
  Created 490000 OD-pairs...
  Created 493000 OD-pairs...
  Created 494000 OD-pairs...
  Created 496000 OD-pairs...
  Created 499000 OD-pairs...
  Created 502000 OD-pairs...
  Created 510000 OD-pairs...
  Created 514000 OD-pairs...
  Created 516000 OD-pairs...
  Created 547000 OD-pairs...
  Created 625000 OD-pairs...
  Created 627000 OD-pairs...
  Created 630000 OD-pairs...
  Created 634000 OD-pairs...
  Created 635000 OD-pairs...
  Created 640000 OD-pairs...
  Created 642000 OD-pairs...
  Created 644000 OD-pairs...
  Created 648000 OD-pairs...
  Created 651000 OD-pairs...
  Created 652000 OD-pairs...
  Created 654000 OD-pairs...
  Created 655000 OD-pairs...
  Created 658000 OD-pairs...
  Created 661000 OD-pairs...
  Created 663000 OD-pairs...
  Created 665000 OD-pairs...
  Created 666000 OD-pairs...
  Created 667000 OD-pairs...
  Created 670000 OD-pairs...
  Created 671000 OD-pairs...
  Created 675000 OD-pairs...
  Created 678000 OD-pairs...
  Created 680000 OD-pairs...
  Created 682000 OD-pairs...
  Created 684000 OD-pairs...
  Created 686000 OD-pairs...
  Created 689000 OD-pairs...
  Created 691000 OD-pairs...
  Created 695000 OD-pairs...
  Created 696000 OD-pairs...
  Created 697000 OD-pairs...
  Created 698000 OD-pairs...
  Created 699000 OD-pairs...
  Created 705000 OD-pairs...
  Created 707000 OD-pairs...
  Created 713000 OD-pairs...
  Created 714000 OD-pairs...
  Created 715000 OD-pairs...
  Created 716000 OD-pairs...
  Created 721000 OD-pairs...
  Created 722000 OD-pairs...
  Created 724000 OD-pairs...
  Created 725000 OD-pairs...
  Created 726000 OD-pairs...
  Created 728000 OD-pairs...
  Created 729000 OD-pairs...
  Created 767000 OD-pairs...
  Created 768000 OD-pairs...
  Created 770000 OD-pairs...
  Created 771000 OD-pairs...
  Created 835000 OD-pairs...
  Created 836000 OD-pairs...
  Created 837000 OD-pairs...
  Created 838000 OD-pairs...
  Created 842000 OD-pairs...
  Created 843000 OD-pairs...
  Created 845000 OD-pairs...
  Created 846000 OD-pairs...
  Created 847000 OD-pairs...
  Created 848000 OD-pairs...
  Created 851000 OD-pairs...

[SUCCESS] Created 227299 OD-pairs and 227299 paths
  Filtered out 680,467 local routes at path creation stage
  (These were created by boundary-crossing logic setting origin_node = dest_node)
  Average nodes per path: 6.34
  Average path length: 759.8 km

================================================================================
SCALING TRANSPORT DEMAND (F)
================================================================================
Reference points: 2015=798,470, 2024=932,283
Annual change: 14,868.11 per year
Base year (2030) demand: 1,021,492
Scaling range: 0.8544 (2020) to 1.4367 (2060)
Original total demand (constant, base year): 222,914,152
Scaled total demand (2020): 190,468,343
Scaled total demand (2060): 320,251,581

================================================================================
AGGREGATING OD-PAIRS BY NUTS-2 REGIONS
================================================================================
  OD-pairs before aggregation: 227299
  Unique NUTS-2 OD-pairs: 6055
[OK] Aggregated to 6055 OD-pairs
     Vehicle stock entries: 30275
     Reduction: 6055 individual routes -> 6055 aggregated

================================================================================
STEP 4: CREATING MANDATORY BREAKS
================================================================================
[OK] Created 8260 mandatory break points
     Average breaks per path: 1.36

================================================================================
STEP 5: SAVING RESULTS
================================================================================
[OK] Saved GeographicElement.yaml (81 entries)
[OK] Saved Path.yaml (6055 entries)
[OK] Saved Odpair.yaml (6055 entries)
[OK] Saved InitialVehicleStock.yaml (30275 entries)
[OK] Saved MandatoryBreaks.yaml (8260 entries)

[SUCCESS] All files saved to: C:\Github\SM\iDesignRES_transcompmodel\examples\moving_loads_SM\input_data

================================================================================
PREPROCESSING COMPLETE - SUMMARY
================================================================================
  Geographic elements (NUTS-2): 81
  OD-pairs (NOT aggregated):    6055
  Paths (collapsed nodes):      6055
  Initial vehicle stock:        30275
  Mandatory breaks:             8260
================================================================================

KEY FEATURES:
  [OK] NUTS-2 aggregated nodes (MAXIMUM capacity planning efficiency)
  [OK] Collapsed path sequences (minimal nodes in routes)
  [OK] Original traffic distances (accuracy preserved)
  [OK] Individual OD-pairs kept (demand detail preserved)
  [OK] Mandatory breaks calculated correctly
================================================================================

[SUCCESS] NUTS-2 preprocessing finished!
